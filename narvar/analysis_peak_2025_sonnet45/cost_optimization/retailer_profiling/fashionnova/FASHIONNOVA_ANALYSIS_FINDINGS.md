# fashionnova Usage Analysis - Key Findings

**Date:** November 19, 2025  
**Analysis Period:** Sep-Oct 2024 (2 months)  
**Status:** ‚ö†Ô∏è PARTIAL - Parameterized queries limit analysis depth

---

## üéØ Executive Summary

**fashionnova Total Cost:** $99,718/year
- Production (attributed): $97,105 (97.4%)
- Consumption (queries): $2,613 (2.6%)

**Query Profile:**
- Total queries: 4,015 (Sep-Oct 2024)
- Query pattern: 99% are carrier performance analytical queries
- Date filters: Parameterized (cannot extract actual values)

**Optimization Assessment:**
- ‚úÖ **Latency optimization: VIABLE** - Analytical queries can tolerate 12-24 hour delays
- ‚ö†Ô∏è **Retention optimization: UNCERTAIN** - Cannot determine from parameterized queries

---

## üìä Query Analysis Results

### Cost Breakdown

| Category | Queries | % Queries | Slot-Hours | Cost/Year | % Cost |
|----------|---------|-----------|------------|-----------|--------|
| **Analytical** (no visible date filter) | 2,624 | 65% | 8,795 | $2,607 | 99.8% |
| **Operational** (with date filter) | 1,391 | 35% | 21 | $6 | 0.2% |
| **Total** | 4,015 | 100% | 8,816 | $2,613 | 100% |

**By table queried:**
- shipments views: 96.4% of cost
- benchmarks: 0.03%
- returns: 0.02%
- orders: 0.01%

---

## üîç Critical Discovery: Parameterized Queries

**What we found:**

The expensive analytical queries (99% of cost) use parameterized date filters:

```sql
SELECT Avg(DATE_DIFF(ship_date, event_ts, DAY))
FROM monitor.v_shipments
LEFT JOIN monitor.v_shipments_events
WHERE carrier_moniker = 'dhlglobal'
  AND datetime_trunc(ship_date, day) BETWEEN ? AND ?  -- Parameterized!
```

**Implications:**

‚úÖ **What we CAN determine:**
- Queries ARE filtering by date range (not scanning full history blindly)
- `BETWEEN ? AND ?` pattern suggests bounded ranges
- Queries are analytical (calculating carrier performance metrics)
- NOT time-sensitive (historical analysis, not real-time monitoring)

‚ùå **What we CANNOT determine:**
- Actual date range values (e.g., last 30 days? last 90 days? last year?)
- Exact retention requirements
- Whether ranges vary by query or are consistent

**Why parameterized?**
- Likely generated by BI tool (Metabase, Looker, etc.)
- Dashboard with user-selectable date range
- Parameters injected at runtime

---

## ‚úÖ Latency Analysis - HIGH CONFIDENCE

### Finding: fashionnova Can Tolerate Delayed Data

**Evidence:**

1. **Query Pattern (99% of cost):**
   - Carrier performance analytics: `Avg(DATE_DIFF(ship_date, event_ts))`
   - Historical aggregations over date ranges
   - NOT operational monitoring

2. **Execution Timing:**
   - Queries run during business hours (8am-6pm)
   - Suggests interactive/dashboard usage, not real-time alerts
   - No evidence of sub-hour refresh requirements

3. **Query Complexity:**
   - Heavy JOINs (v_shipments + v_shipments_events)
   - Large data scans (avg 3.35 slot-hours per query)
   - These are analysis queries, not lookups

**Latency Tolerance Assessment:**

| Delay | Impact on fashionnova | Confidence |
|-------|----------------------|------------|
| 1-hour batching | Minimal - dashboards refresh hourly anyway | High |
| 6-hour batching | Low - analytics don't need sub-6-hour freshness | High |
| 12-hour batching | Low - historical analysis not time-critical | High |
| 24-hour batching | Moderate - daily refresh might delay morning reports | Medium |

**Recommendation:**
- ‚úÖ **fashionnova can accept 6-12 hour data delays** with minimal business impact
- 99% of their cost is from historical analytics (not time-sensitive)
- Only 1% of queries use CURRENT_DATE (operational monitoring)

**Confidence:** HIGH (85%) - Based on query pattern analysis

---

## ‚ö†Ô∏è Retention Analysis - LOW CONFIDENCE

### Finding: Cannot Determine Exact Requirements

**What we know:**
- Queries use `BETWEEN ? AND ?` date filters (parameterized)
- Cannot extract actual date range values
- Pattern suggests bounded ranges (not full history scans)

**What we don't know:**
- Are ranges 30 days? 90 days? 365 days? 2+ years?
- Do ranges vary by carrier or use case?
- Are there compliance requirements driving retention?

**Inference from business context:**

Carrier performance analytics typically use:
- **30-day windows:** Recent performance monitoring
- **90-day windows:** Quarterly comparisons
- **365-day windows:** Year-over-year trends
- **2+ year windows:** Long-term trend analysis

**Retention Requirement Scenarios:**

| Scenario | Likelihood | Retention Needed | Savings Potential |
|----------|-----------|------------------|-------------------|
| Queries use 30-day windows | Medium | 6 months safe | $18K-$20K/year |
| Queries use 90-day windows | High | 1 year safe | $16K-$18K/year |
| Queries use 365-day windows | Medium | 2 years safe | $14K-$16K/year |
| Queries use full history | Low | Cannot reduce | $0 |

**Recommendation:**
- ‚ö†Ô∏è **Cannot make data-driven recommendation** without knowing parameter values
- **Action required:** Survey fashionnova or analyze dashboard configurations
- **Conservative assumption:** 1-2 year retention (covers 90-day and 365-day windows)

**Confidence:** LOW (30%) - Insufficient data

---

## üéØ Optimization Recommendations

### Primary Lever: Latency Optimization ‚úÖ **PROCEED**

**Recommendation:** Implement 6-12 hour batching for fashionnova

**Rationale:**
- 99% of queries are historical analytics (not time-sensitive)
- Query pattern analysis shows no real-time requirements
- Carrier performance metrics don't need sub-6-hour freshness

**Expected Impact:**
- fashionnova cost savings: Minimal direct savings (consumption is only $2.6K)
- Platform cost savings: Reduces MERGE frequency, saves $10K-$29K platform-wide
- Business impact on fashionnova: LOW (dashboards refresh less frequently, but data is still accurate)

**Implementation:**
- Start with 6-hour batching (low risk)
- Monitor dashboard usage and feedback
- Can extend to 12-24 hour if acceptable

**Confidence:** HIGH (85%)

---

### Secondary Lever: Retention Optimization ‚ö†Ô∏è **VALIDATE FIRST**

**Recommendation:** Survey fashionnova before implementing

**Questions to ask:**
1. What date ranges do you typically use in Monitor dashboards?
   - Last 30 days?
   - Last 90 days?
   - Last year?
   - Year-over-year comparisons (2+ years)?

2. Do you need historical data for:
   - Trend analysis?
   - Seasonal comparisons?
   - Compliance/auditing?

3. Would 1-year retention break any of your use cases?

**Based on responses:**
- If mostly use <90 day windows ‚Üí 1-year retention safe (save $16K-$18K)
- If need year-over-year ‚Üí 2-year retention minimum (save $14K-$16K)
- If need full history ‚Üí Cannot optimize retention

**Confidence:** LOW (30%) - Requires business validation

---

## üìà Platform-Wide Implications

### If fashionnova pattern is representative:

**Assumption:** fashionnova (74% of platform slot-hours) drives platform requirements

**If true:**
1. **Most retailers use analytical queries** with parameterized date ranges
2. **Latency optimization is viable** platform-wide (analytical workloads tolerate delays)
3. **Retention optimization is uncertain** (depends on actual parameter ranges)

**Action needed:**
- Sample 5-10 other high-cost retailers
- Check if they have similar query patterns (parameterized carrier analytics)
- If yes ‚Üí latency optimization is the primary lever
- If no ‚Üí need retailer-specific strategies

---

## üî¨ Technical Details

### Query Execution Pattern

**Time of day distribution:**
- 8am-6pm: High activity (business hours)
- Off-hours: Minimal activity
- **Suggests:** Interactive dashboard usage, not automated alerts

**Query frequency:**
- ~67 queries/day
- Concentrated in morning hours
- **Suggests:** Daily dashboard reviews, not continuous monitoring

### Query Characteristics

**Expensive queries (>5 slot-hours):**
- Pattern: Carrier performance aggregations
- JOIN: v_shipments + v_shipments_events
- Filter: carrier_moniker + parameterized date range
- Calculation: AVG(DATE_DIFF(...))

**Cheap queries (<0.1 slot-hours):**
- Pattern: Simple SELECTs with CURRENT_DATE() or INTERVAL
- Single table queries
- Small result sets

---

## üìã Data Gaps & Next Steps

### What we successfully analyzed:

‚úÖ Cost breakdown ($99K = $97K production + $2.6K consumption)  
‚úÖ Query patterns (analytical vs operational)  
‚úÖ Table usage (96% shipments, minimal orders/returns)  
‚úÖ Latency tolerance (historical analytics can accept delays)  
‚úÖ Coverage assessment (72% have ship_date mentions, but parameterized)

### What we could NOT determine:

‚ùå Exact date range parameters (BETWEEN ? AND ? values)  
‚ùå Actual retention requirements (30 days? 90 days? 365 days?)  
‚ùå Dashboard-specific configurations  
‚ùå Business case segmentation (need to infer from context)

### Required next steps:

1. **Survey fashionnova team:**
   - What date ranges do your dashboards use?
   - Do you need year-over-year comparisons?
   - What's your longest lookback period?

2. **Analyze dashboard configurations:**
   - If using Metabase/Looker, check saved dashboard settings
   - Extract default date range parameters
   - Identify most common time windows

3. **Sample other retailers:**
   - Do they have similar parameterized query patterns?
   - Or is fashionnova unique in this approach?

4. **Refine business case taxonomy:**
   - Review query samples in QUERY_CLASSIFICATION_SAMPLES.md
   - Define business case categories
   - Map queries to use cases

---

## üí° Key Insights

### 1. fashionnova Drives Platform Behavior

- 74% of platform slot-hours
- Their query patterns likely represent platform design
- If they can tolerate delays, most retailers probably can

### 2. Parameterized Queries Are Common

- Suggests BI tool usage (not hand-written SQL)
- Makes automated analysis harder
- Requires business context or dashboard inspection

### 3. Latency vs Retention Trade-off

- **Latency:** Can determine tolerance from query patterns (HIGH confidence)
- **Retention:** Cannot determine from queries alone (LOW confidence)
- **Implication:** Latency optimization should be prioritized (more certain ROI)

### 4. Query Cost Distribution

- 65% of queries = 99.8% of cost (analytical)
- 35% of queries = 0.2% of cost (operational)
- **Optimization should focus on analytical workload**, not operational

---

**Created by:** Sophia (AI) + Cezar  
**Date:** November 19, 2025  
**Next:** Refine query classification and validate with fashionnova team  
**Data:** See `all_queries_for_classification.csv` (500 queries with full text)


